---
layout: post
title: 如何同步数据
category: 架构
tags: [未完成] 
---

## 如何同步数据?

​	同步两个系统之间的数据一直是开发中的痛点。不论是从数据库到数据库还是从其他子系统到数据库、数据库到其他子系统。考虑到同步的一致性、实时性、原子性经常很难得到保证，所以经常采取很多极端的方法，例如反复定时同步、每次同步先清空目标库中历史数据、或每次同步将目标库的历史数据回写到被同步的系统中等。一旦调节不好，那么整个同步将产生大量的脏数据，甚至导致两个系统都不可用。

### 1. 一次同步，从此禁止访问原数据系统

​	一次同步，从此禁止访问原数据系统。很好理解，通过禁止访问原数据系统，这样再也不会产生需要同步的需求，系统间数据实时性得到保证。当然某种程度上少量使用原数据系统，产生很少的同步需求也是可以的，这样通过手动同步数据的妥协某种程度上也是可以接受的。

​	实际上，数据实时性总是导致一系列问题的根本。没有数据实时性，我们可以对原数据系统与新系统间数据的一致性、原子性更好的把控，例如一旦同步失败，我们可以实现清空同步数据并再次同步，直到成功为止。

​	注意：尽量不去访问原数据系统，尽量减少重命名问题（原数据系统一旦重命名某条数据，新数据系统可能要删除一条记录，然后重新添加新数据）。增强原数据系统与新系统间的数据一致性的比对。

### 2. 定时同步

​	从定时同步开始对数据同步的实时性提出越来越高的要求。

​	实时性越高的数据，读写越容易冲突，定时同步也越容易出错。这里涉及到的情况可以参考分布式数据库的概念，不同机器间的数据库同步、事务很难得到保证，因此出现了分布式事务。但是分布式事务的缺点很明显：性能不理想，一旦网路故障或并发量很高则很难满足情况。类似的定时同步也有同样的问题，一方面，定时同步的间隔和用户读写操作的频率如果不能很好分配，则很大程度上导致同步失败；另一方面，面对同步失败的情况，很难在有效的时间内重新实现同步成功。